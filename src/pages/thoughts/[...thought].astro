---
import BaseLayout from '../../layouts/BaseLayout.astro';

// Generate all available slugs
export async function getStaticPaths() {
  const postImports = import.meta.glob('../../content/thoughts/*/*/*/index.md');
  const paths = Object.keys(postImports).map((path) => {
    const parts = path.split('/');
    const yyyy = parts[4];
    const mm = parts[5];
    const slug = parts[6];
    return { params: { thought: `${yyyy}/${mm}/${slug}` } };
  });
  console.log('getStaticPaths returned:', paths);
  return paths;
}

// Get the slug for this page
const { thought } = Astro.params;
console.log('THOUGHT:', thought);

// Import the correct post dynamically
const postImports = import.meta.glob('../../content/thoughts/*/*/*/index.md');
const postImport = postImports[`../../content/thoughts/${thought}/index.md`];

if (!postImport) {
  throw new Error(`Post not found: ${thought}`);
}

// Resolve the post module
const post = await postImport();
const { frontmatter, Content } = post;
---

<BaseLayout title={frontmatter.title}>
  <article class="prose">
    <h1>{frontmatter.title}</h1>
    {frontmatter.date && <time datetime={frontmatter.date}>{frontmatter.date}</time>}
    {frontmatter.date && frontmatter.topics && <span> &mdash; </span>}
    {frontmatter.topics && <em>{frontmatter.topics.join(', ')}</em>}
    <Content />
  </article>
</BaseLayout>
