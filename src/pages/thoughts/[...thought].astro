---
import BaseLayout from '../../layouts/BaseLayout.astro';

// Generate all available slugs
export async function getStaticPaths() {
  // Support both .md and .mdx files
  const postImports = import.meta.glob('../../content/thoughts/*/*/*/index.{md,mdx}');
  const paths = Object.keys(postImports).map((path) => {
    const parts = path.split('/');
    const yyyy = parts[4];
    const mm = parts[5];
    const slug = parts[6];
    return { params: { thought: `${yyyy}/${mm}/${slug}` } };
  });
  return paths;
}

// Get the slug for this page
const { thought } = Astro.params;

// Support both .md and .mdx files
const postImports = import.meta.glob('../../content/thoughts/*/*/*/index.{md,mdx}');

// Try to resolve .mdx first, then .md
const mdxPath = `../../content/thoughts/${thought}/index.mdx`;
const mdPath = `../../content/thoughts/${thought}/index.md`;
const postImport = postImports[mdxPath] || postImports[mdPath];

if (!postImport) {
  throw new Error(`Post not found: ${thought}`);
}

// Resolve the post module
const post = await postImport() as { frontmatter: any; Content: any };
const { frontmatter, Content } = post;
---

<BaseLayout title={frontmatter.title}>
  <article class="prose">
    <h1>{frontmatter.title}</h1>
    {frontmatter.date && <time datetime={frontmatter.date}>{frontmatter.date}</time>}
    {frontmatter.date && frontmatter.topics && <span> &mdash; </span>}
    {frontmatter.topics && <em>{frontmatter.topics.join(', ')}</em>}
    <Content />
  </article>
</BaseLayout>
